# 双臂机械臂末端位置优化测试程序

## 功能特性

### 🚀 主要功能
- **安全运动控制**: 基于安全等级的运动控制
- **实时回零功能**: 按 'r' 键随时回零
- **紧急停止**: 按 'q' 键紧急停止
- **自动测试**: 自动执行多位置测试
- **安全监控**: 实时监控机械臂状态

### ⌨️ 快捷键操作
- **'r' + Enter**: 立即回零（终止当前动作）
- **'q' + Enter**: 紧急停止
- **Ctrl + C**: 程序退出

## 使用方法

### 1. 运行程序
```bash
cd /home/vertax/Downloads/ROS2_AC-one_Play/py/arx_x5_python
python test_dual_arm_eef_pos_optimized.py
```

### 2. 自动测试流程
程序启动后会自动执行以下流程：
1. 初始化双臂机械臂
2. 安全回零
3. 执行多位置测试
4. 进入重力补偿模式
5. 进入安全监控模式

在监控模式下，你可以：
- 按 'r' + Enter 随时回零
- 按 'q' + Enter 紧急停止

### 3. 安全特性

#### 工作空间限制
- X轴: -0.8m 到 0.8m
- Y轴: -0.8m 到 0.8m  
- Z轴: -0.2m 到 0.8m
- 最低高度: -0.05m
- 最大伸展距离: 0.7m

#### 安全等级
- **LOW**: 最大速度 10.0 m/s（调试用）
- **MEDIUM**: 最大速度 0.3 m/s
- **HIGH**: 最大速度 0.1 m/s

#### 运动参数
- 控制频率: 150 Hz
- 最小运动时间: 0.3s
- 最大运动时间: 15.0s

## 核心功能说明

### 1. 实时回零功能
- **触发方式**: 按 'r' + Enter
- **响应时间**: 立即响应
- **安全机制**: 先停止当前运动，再执行回零
- **适用场景**: 任何时刻都可以使用

### 2. 安全监控
- **实时监控**: 位置、速度、加速度
- **异常检测**: 超出工作空间、速度过快等
- **自动停止**: 检测到异常时自动停止运动

### 3. 平滑运动
- **插值算法**: 使用sigmoid函数实现平滑加速减速
- **四元数插值**: 球面线性插值保证姿态平滑变化
- **时间控制**: 精确的时间控制确保运动流畅

## 安全使用指南

### ⚠️ 运行前检查
1. 确认机械臂周围1米范围内无人员
2. 确认工作空间内无障碍物
3. 检查CAN总线连接
4. 确认紧急停止按钮可用

### 🛡️ 安全操作
1. **首次运行**: 建议使用交互式菜单逐步测试
2. **实时监控**: 运行期间保持监控状态
3. **紧急情况**: 立即按 'q' 键或 Ctrl+C
4. **回零操作**: 按 'r' 键可随时安全回零

### 📋 故障排除
- **CAN通信失败**: 检查CAN端口和权限
- **位置超限**: 调整目标位置或工作空间限制
- **速度过快**: 检查安全等级设置
- **回零失败**: 检查机械臂状态和连接

## 技术细节

### 代码结构
- `SafetyMonitor`: 安全监控器
- `OptimizedDualArmController`: 双臂控制器
- `SafetyConfig`: 安全配置类
- `SafetyLevel`: 安全等级枚举

### 关键方法
- `set_ee_pose_smooth()`: 平滑运动控制
- `go_home_safe()`: 安全回零
- `handle_go_home_request()`: 处理回零请求
- `interactive_test_menu()`: 交互式菜单

## 注意事项

1. **安全第一**: 始终遵循安全操作规范
2. **监控状态**: 运行期间保持监控
3. **及时回零**: 遇到异常立即回零
4. **保存配置**: 记录成功的参数配置

---

**记住：安全永远是第一位的！**
